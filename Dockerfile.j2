{#
    This is the template from which all Dockerfiles are generated. As such,
    this is the file you should edit in order to make changes. We include
    a comment about this in the generated file.
-#}
# This file is automatically generated with Dockerfile.j2 as a template. Do not
# edit by hand, since your changes will be lost!
FROM buildpack-deps AS builder

# Create a shallow clone of the implementation repository in the work directory,
# containing only the code of the specified version/tag.
WORKDIR /{{ implementation }}
RUN git clone --branch {{ tag }} --depth 1 {{ url }} .

{%- if version | in_version_range("1.9.0", "1.9.7") %}

# Botan version 1.9.0 to 1.9.7 do not compile, and some patched from later
# releases must be applied first.
RUN curl https://github.com/randombit/botan/commit/211d835a356f55e037ff8035017d79c458f13615.patch | git apply --include=src/alloc/secmem.h -
{%- endif %}
{%- if version | in_version_range("1.11.6", "1.11.13") %}

# Botan version 1.11.6 to 1.11.13 requires boost-filesystem in order to
# compile.
RUN apt-get update && apt-get install -y libboost-filesystem-dev
{%- endif %}
{%- if version | in_version_range("1.11.25", "1.11.29") %}

# Botan version 1.11.25 to 1.11.29 are missing a <cmath> include, which causes
# the compilation to fail. This is fixed in a later version. By applying the
# fix to these earlier releases, the issue is resolved and Botan can be
# compiled.
RUN curl https://github.com/randombit/botan/commit/585a9056166c32d1d6537c163b8960b2106e3e21.patch | git apply -
{%- endif %}

# Build
{% if version | in_version_range("1.5", "1.8.2") -%}
RUN ./configure.pl
{% else -%}
RUN ./configure.py
{% endif -%}
RUN make
